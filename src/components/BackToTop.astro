---
import { Icon } from 'astro-icon/components'

/**
 * BackToTop Component
 *
 * @description A fixed back-to-top arrow button that appears when scrolling down
 */
---

<button
  id="back-to-top"
  class="fixed bottom-6 right-6 z-50 p-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform translate-y-16 opacity-0 hover:scale-110 focus:scale-110 focus:outline-none"
  aria-label="Zurück nach oben"
  title="Zurück nach oben"
>
  <Icon name="lucide:arrow-up" class="w-5 h-5" />
</button>

<script>
  function initBackToTop() {
    const backToTopButton = document.getElementById('back-to-top');
    if (!backToTopButton) return;

    // Show/hide button based on scroll position
    function toggleVisibility() {
      if (!backToTopButton) return;
      
      if (window.scrollY > 300) {
        backToTopButton.classList.remove('translate-y-16', 'opacity-0');
        backToTopButton.classList.add('translate-y-0', 'opacity-100');
      } else {
        backToTopButton.classList.add('translate-y-16', 'opacity-0');
        backToTopButton.classList.remove('translate-y-0', 'opacity-100');
      }
    }

    // Smooth scroll to top
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // Event listeners
    window.addEventListener('scroll', toggleVisibility);
    backToTopButton.addEventListener('click', scrollToTop);

    // Handle keyboard navigation
    backToTopButton.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        scrollToTop();
      }
    });

    // Initial check
    toggleVisibility();
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initBackToTop);

  // Re-initialize on view transitions
  document.addEventListener('astro:page-load', initBackToTop);
</script>

<style>
  #back-to-top {
    /* Ensure proper stacking above other elements */
    z-index: 9999;
    background-color: light-dark(var(--color-primary-300), var(--color-primary-100));
    color: light-dark(var(--color-neutral-900), var(--color-neutral-900));
    border: 2px solid light-dark(var(--color-primary-200), var(--color-primary-100));
  }
  
  #back-to-top:hover,
  #back-to-top:focus-visible {
    background-color: light-dark(var(--color-primary-400), var(--color-primary-300));
    border-color: light-dark(var(--color-primary-300), var(--color-primary-200));
  }
  
  #back-to-top:focus-visible {
    outline: 2px solid light-dark(var(--color-primary-400), var(--color-primary-200));
    outline-offset: 2px;
  }
  
  [data-icon] {
    width: 1.25rem;
    height: 1.25rem;
  }
</style>
